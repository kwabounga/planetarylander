var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.flat",function(a){return a?a:function(b){b=void 0===b?1:b;for(var c=[],d=0;d<this.length;d++){var e=this[d];Array.isArray(e)&&0<b?(e=Array.prototype.flat.call(e,b-1),c.push.apply(c,e)):c.push(e)}return c}},"es9","es5");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,b-d.length)+d}},"es8","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
var State=function(){function a(){this.width=800;this.height=600;this.isMobile=Tools.isMobile();this.isDebug=this.isPause=!1;this.keySpace=this.keyRight=this.keyLeft=this.keyUp=null;this.menuData=void 0;this.game={currentWorld:0,currentLevel:0,speedX:0,speedY:0,orientation:0,fuelMax:500,fuel:500,shell:100,power:0};this.log=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];b.isDebug&&console.log.apply(console,$jscomp.arrayFromIterable(d))};return{width:this.width,height:this.height,
isMobile:this.isMobile,isPause:this.isPause,isDebug:this.isDebug,keyUp:this.keyUp,keyLeft:this.keyLeft,keyRight:this.keyRight,keySpace:this.keySpace,game:this.game,menuData:this.menuData,log:this.log}}var b;return{getInstance:function(){b||(b=a());return b}}}(),Tools=Tools||{};Tools.availableSize={width:function(a){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},height:function(a){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}};
Tools.randomBetween=function(a,b){a=void 0===a?-40:a;return Math.random()*((void 0===b?40:b)-a)+a};Tools.rb=function(a){a=void 0===a?15:a;return!(Math.floor(Math.random()*a)>a/3)};Tools.ajaxGet=function(a,b){var c=new XMLHttpRequest;c.open("GET",a);c.addEventListener("load",function(){200<=c.status&&400>c.status&&b(c.responseText)});c.addEventListener("error",function(){});c.send(null)};
Tools.isMobile=function(){console.log(navigator.userAgent);var a=(new RegExp(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile Safari/gi)).test(navigator.userAgent);console.log(a);return a};Tools.getHash=function(){var a="moon";(new RegExp(/moon|europa|titan|mars/)).test(window.location.hash.replace("#",""))&&(a=window.location.hash.replace("#",""));return a};Tools.pixiColor=function(a){return a.replace("#","0x")};
Tools.SpriteSheetAutoSlicer=function(a,b,c,d){for(var e={},f=Math.floor(d._frame.height/c),g=Math.floor(d._frame.width/b),l=0,n=0;n<c;n++)for(var m=0;m<b;m++){var h=m*g,k=n*f;e[a+"_"+l]={frame:{x:h+d._frame.x,y:k+d._frame.y,w:g,h:f},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:g,h:f},sourceSize:{w:g,h:f},original:{x:h,y:k}};l++}return JSON.stringify({frames:e,meta:{app:"KWA SpriteSheetAutoSlicer",version:"0.1",image:a+".png",format:"RGBA8888",size:{w:d.baseTexture.width,h:d.baseTexture.height},
scale:"1"}})};Tools.wireFrameFromVertex=function(a,b,c,d,e){d=void 0===d?!1:d;e=void 0===e?"#86f11c":e;a=c.flat();var f=new PIXI.Graphics;f.lineStyle(1,Tools.pixiColor(e),1);f.moveTo(a[0].x,a[0].y);a.forEach(function(h){f.lineTo(h.x,h.y)});f.lineTo(a[0].x,a[0].y);f.lineTo(a[1].x,a[1].y);f.endFill();if(d){var g=Infinity,l=-Infinity,n=Infinity,m=-Infinity;a.map(function(h){g=Math.min(g,h.x);l=Math.max(l,h.x);n=Math.min(n,h.y);m=Math.max(m,h.y)});f.pivot={x:l/2+g,y:m/2+n}}return f};
Tools.customText=function(a,b){b=void 0===b?!1:b;var c=new PIXI.extras.BitmapText(a.text,{font:a.fontSize+"px "+a.font,tint:Tools.pixiColor(a.color)});b?(c.align="center",c.x=a.x-c.width/2):c.x=a.x;c.y=a.y;return c};
Tools.dataLoader=function(){function a(){this.toLoad=[];this.data={};this.lID=0;this.xhr=new XMLHttpRequest;this.callBack=null;this.clean=function(){b.xhr=new XMLHttpRequest;b.toLoad=[];b.data={};b.lID=0;b.callBack=null};this.add=function(c,d){b.toLoad.push([c,d])};this.once=function(c){b.callback=c};this.load=function(){function c(){b.xhr.open("GET",b.toLoad[b.lID][1]);b.xhr.send(null)}function d(){b.lID<b.toLoad.length-1?(b.lID++,c()):b.callback&&b.callback(b.data)}0==b.toLoad.length?console.warn("Must add files with Tools.dataLoader.add(name, jsonUri) method before start loading"):
b.callback?(b.xhr.addEventListener("error",function(){b.data[b.toLoad[b.lID][0]]={error:"something wrong with "+b.toLoad[b.lID][1]};d()}),b.xhr.addEventListener("load",function(){404===b.xhr.status&&(b.data[b.toLoad[b.lID][0]]={error:"ERROR: "+b.toLoad[b.lID][1]+" 404 (Not Found)"},d());200<=b.xhr.status&&400>b.xhr.status&&(b.data[b.toLoad[b.lID][0]]=JSON.parse(b.xhr.responseText),d())}),c()):console.warn("Must register callBack with Tools.dataLoader.once(callBack) method before start loading")};
return{xhr:this.xhr,lID:this.lID,data:this.data,toLoad:this.toLoad,callBack:this.callBack,add:this.add,once:this.once,load:this.load,clean:this.clean}}var b;b||(b=a());return b}();Tools.overwritePixiTexture=function(a,b,c){var d=PIXI.loader;delete d.resources[a];d.add(a,b);d.once("complete",c)};
function keyboard(a){var b={};b.value=a;b.isDown=!1;b.isUp=!0;b.press=void 0;b.release=void 0;b.downHandler=function(e){e.key===b.value&&(b.isUp&&b.press&&b.press(),b.isDown=!0,b.isUp=!1,e.preventDefault())};b.upHandler=function(e){e.key===b.value&&(b.isDown&&b.release&&b.release(),b.isDown=!1,b.isUp=!0,e.preventDefault())};var c=b.downHandler.bind(b),d=b.upHandler.bind(b);window.addEventListener("keydown",c,!1);window.addEventListener("keyup",d,!1);b.unsubscribe=function(){b.isDown=!1;b.isUp=!0;
window.removeEventListener("keydown",c);window.removeEventListener("keyup",d)};return b}
function Ui(){PIXI.Container.call(this);this.state=State.getInstance();this.fuel=this.createTextField({font:"DeadFontWalking",fontSize:20,color:"#ffffff",text:this.state.game.fuel+"/"+this.state.game.fuelMax,x:5,y:5});this.speedX=this.createTextField({font:"DeadFontWalking",fontSize:20,color:"#ffff00",text:"vX: 0 m/s",x:5,y:30});this.speedY=this.createTextField({font:"DeadFontWalking",fontSize:20,color:"#ffff00",text:"vY: 0 m/s",x:5,y:55});this.orientation=this.createTextField({font:"DeadFontWalking",
fontSize:20,color:"#ffff00",text:"0deg",x:5,y:80});this.shell=this.createTextField({font:"DeadFontWalking",fontSize:20,color:"#ffff00",text:this.state.game.shell+"%",x:5,y:105});this.screenInfos=Tools.customText({font:"DeadFontWalking",fontSize:40,color:"#fffafa",text:"Get Ready",x:400,y:40},!0);this.addChild(this.screenInfos)}Ui.prototype=Object.create(PIXI.Container.prototype);
Ui.prototype.createTextField=function(a){var b=new PIXI.extras.BitmapText(a.text,{font:a.fontSize+"px "+a.font,tint:Tools.pixiColor(a.color)});b.dirty=!0;this.addChild(b);b.x=a.x;b.y=a.y;return b};Ui.prototype.updateTextField=function(a,b,c,d){c=void 0===c?null:c;a.text=b;c&&a._font.tint!=c&&(a._font.tint=c);if(void 0===d?0:d)a.x=400-a.width/2};
Ui.prototype.update=function(){function a(b,c){return Tools.pixiColor(Math.abs(b)<=c?"#00ff00":"#ff0000")}this.updateTextField(this.fuel,Math.floor(this.state.game.fuel)+"/"+this.state.game.fuelMax,Tools.pixiColor(50<=Math.abs(this.state.game.fuel)?"#00ff00":"#ff0000"));this.updateTextField(this.speedX,"vX: "+Math.floor(25*this.state.game.speedX)+" m/s",a(25*this.state.game.speedX,this.state.game.speedMax));this.updateTextField(this.speedY,"vY: "+Math.floor(25*this.state.game.speedY)+" m/s",a(25*
this.state.game.speedY,this.state.game.speedMax));this.updateTextField(this.orientation,Math.floor(this.state.game.orientation)+" deg",a(this.state.game.orientation,30));this.updateTextField(this.shell,Math.floor(this.state.game.shell)+"%",Tools.pixiColor(50<=Math.abs(this.state.game.shell)?"#00ff00":"#ff0000"))};
function Level(a,b){b=void 0===b?null:b;PIXI.Container.call(this);this.ui=a.ui;this.engine=a.engine;this.stage=a.stage;this.data=a.data;this.isGameOver=!1;this.state=State.getInstance();this.terrain=this.lander=null;this.landZones=[];this.stars=[];this.bonus=[];this.malus=[];this.callBack=b;this.landerExploded=null;this.stage.addChild(this);this.tweenRule=null;this.overWriteSettings(this.data.levels[this.state.game.currentLevel]);this.loadTerrain(this.data.levels[this.state.game.currentLevel])}
Level.prototype=Object.create(PIXI.Container.prototype);Level.prototype.overWriteSettings=function(a){a.fuelMax&&(this.state.game.fuelMax=a.fuelMax,this.state.game.fuel=a.fuelMax);a.shell&&(this.state.game.shell=a.shell)};Level.prototype.loadTerrain=function(a){var b=this,c=this;Terrains.load(a,c.state.game.currentLevel,function(d){c.terrain=d;b.addChild(c.terrain.sprite);c.state.isDebug&&b.addChild(c.terrain.wireFrame);c.callBack&&(c.init(),c.callBack())})};
Level.prototype.init=function(){this.state.log("terrain",this.terrain.body);this.addLander();this.addlandZones();this.addStars();this.addBonus();this.addCollisions();this.applyRules()};
Level.prototype.addCollisions=function(){var a=this;Matter.Events.on(a.engine,"collisionActive",function(b){if(!a.lander.isDie){b=b.pairs;a.state.log("collisionActive",b[0]);for(var c=0,d=b.length;c!=d;++c){var e=b[c];a.terrain.body.parts.includes(e.bodyA)?a.damageLander():a.terrain.body.parts.includes(e.bodyB)&&a.damageLander()}}});Matter.Events.on(a.engine,"collisionStart",function(b){b=b.pairs;a.state.log("collisionStart",b[0]);for(var c=0,d=b.length;c!=d;++c){var e=b[c];a.landZones.forEach(function(f){e.bodyA===
f&&e.bodyB===a.lander.body?a.end():e.bodyB===f&&e.bodyA===a.lander.body&&a.end()});if(a.lander.isDie)break;a.stars.forEach(function(f){e.bodyA===f.body?a.getStar(f):e.bodyB===f.body&&a.getStar(f)});a.bonus.forEach(function(f){e.bodyA===f.body?a.getBonus(f):e.bodyB===f.body&&a.getBonus(f)})}})};
Level.prototype.die=function(){var a=this;this.lander.isDie=!0;console.log(this.lander.sprite.params.sprite);Landers.explode(a.lander,a,function(b){a.landerExploded=b;a.lander.sprite.visible=!1;a.lander.body.isSensor=!0})};Level.prototype.damageLander=function(){this.state.log("DAMAGE");this.state.game.shell-=Math.abs((this.state.game.speedX+this.state.game.speedY)/2);0>=this.state.game.shell&&(this.state.game.shell=0,this.lander.isDie||this.die())};
Level.prototype.getBonus=function(a){this.lander.isDie||(this.state.log("getBonus !!! ",a),a.isCatched||(gsap.to(a.body.position,{y:-this.y,x:-100,duration:.75,ease:"elastic.in(1, 0.75)"}),a.isCatched=!0,this.state.game[a.type]+=a.amount))};Level.prototype.getStar=function(a){this.lander.isDie||(this.state.log("getStar !!! ",a),a.isCatched||(gsap.to(a.body.position,{y:-this.y,x:-100,duration:.75,ease:"elastic.in(1, 0.75)"}),a.isCatched=!0))};
Level.prototype.gameOver=function(){console.log("GAME OVER");this.removeKeyEvents();this.isGameOver=!0;this.state.isPause=!0};Level.prototype.win=function(){this.lander.isDie||(this.removeKeyEvents(),this.lander.sprite.showFlag(),this.lander.sprite.hideReactor(),this.lander.sprite.hideStabilizersLeft(),this.lander.sprite.hideStabilizersRight(),this.isGameOver=!0,console.log("WIN"))};
Level.prototype.end=function(){this.lander.isDie||(Math.abs(25*this.state.game.speedY)>this.state.game.speedMax||Math.abs(25*this.state.game.speedX)>this.state.game.speedMax?(this.state.game.shell=0,this.damageLander()):this.win())};
Level.prototype.applyRules=function(){console.log(this.engine.world.gravity);if(this.data.levels[this.state.game.currentLevel].rules)switch(this.data.levels[this.state.game.currentLevel].rules.type){case "gravity_change":console.log("GRAVITY_CHANGE");var a=this.data.levels[this.state.game.currentLevel].rules.params;this.tweenRule=gsap.fromTo(this.engine.world.gravity,a.from,a.to)}};
Level.prototype.update=function(){this.updateLander();this.updateStars();this.updateBonus();this.landerExploded&&0<this.landerExploded.bodies.length&&this.updateStack()};Level.prototype.updateStack=function(){var a=this;this.landerExploded.bodies.forEach(function(b,c){a.landerExploded.sprites[c].rotation=b.angle;a.landerExploded.sprites[c].position=b.position})};
Level.prototype.updateLander=function(){this.lander.isDie&&this.lander.body.position.y>=this.terrain.sprite.height+600&&(console.log(this.lander.body),this.gameOver());if(this.state.keyUp&&this.state.keyRight&&this.state.keyLeft&&0<this.state.game.fuel){if(this.state.keyUp.isDown){this.state.game.power+=this.data.lander.motor.reactorPower;this.state.game.power=Math.min(this.state.game.power,this.data.lander.motor.reactorPowerMax);var a=180*this.lander.body.angle/Math.PI,b=-this.state.game.power*Math.cos(a*
Math.PI/180),c=-this.state.game.power*Math.sin(a*Math.PI/180)*-1;this.state.log(a,b,c);Matter.Body.applyForce(this.lander.body,{x:this.lander.body.position.x,y:this.lander.body.position.y},{x:c/200,y:b/200});this.state.game.fuel-=this.data.lander.motor.fuelConsumption}else this.state.game.power=0;this.state.keyRight.isDown&&(Matter.Body.setAngularVelocity(this.lander.body,this.lander.body.angularVelocity+this.data.lander.motor.stabilizersPower),this.state.game.fuel-=this.data.lander.motor.fuelConsumption/
10);this.state.keyLeft.isDown&&(Matter.Body.setAngularVelocity(this.lander.body,this.lander.body.angularVelocity-this.data.lander.motor.stabilizersPower),this.state.game.fuel-=this.data.lander.motor.fuelConsumption/10)}else this.state.game.fuel=0,this.lander.sprite.hideStabilizersLeft(),this.lander.sprite.hideStabilizersRight(),this.lander.sprite.hideReactor();this.state.game.orientation=180*this.lander.body.angle/Math.PI%360;this.state.game.speedX=this.lander.body.velocity.x;this.state.game.speedY=
this.lander.body.velocity.y;this.lander.sprite.position=this.lander.body.position;this.lander.sprite.rotation=this.lander.body.angle;this.state.isDebug&&(this.lander.wireFrame.position=this.lander.body.position,this.lander.wireFrame.rotation=this.lander.body.angle);this.lander.sprite.update()};Level.prototype.addLander=function(){this.state.log("ADD LANDER");this.lander=Landers.create(this.data.lander,this);this.state.log(this.lander.sprite);this.state.isDebug&&this.addChild(this.lander.wireFrame)};
Level.prototype.getLander=function(){return this.lander};Level.prototype.updateBonus=function(){var a=this;this.data.levels[this.state.game.currentLevel].bonus&&this.bonus.forEach(function(b){b.sprite.position=b.body.position;a.state.isDebug&&(b.wireFrame.position=b.body.position)})};Level.prototype.updateStars=function(){var a=this;this.stars.forEach(function(b){b.sprite.position=b.body.position;a.state.isDebug&&(b.wireFrame.position=b.body.position)})};
Level.prototype.addBonus=function(){var a=this;if(this.data.levels[this.state.game.currentLevel].bonus){var b=this;this.data.levels[this.state.game.currentLevel].bonus.forEach(function(c){var d=Matter.Bodies.circle(c.x,c.y,29,{isStatic:!0,isSensor:!0}),e=new PIXI.Graphics;e.lineStyle(2,16706423,1);e.drawCircle(0,0,29);e.endFill();e.position.x=c.x;e.position.y=c.y;b.state.isDebug&&b.addChild(e);var f=new BonusSprite(c.type,c.amount);f.x=c.x;f.y=c.y;a.addChild(f);b.bonus.push({body:d,sprite:f,wireFrame:e,
type:c.type,amount:c.amount})})}};
Level.prototype.addStars=function(){var a=this,b=this.data.levels[this.state.game.currentLevel].stars;this.state.log(b);var c=this;b.forEach(function(d){var e=Matter.Bodies.circle(d.x,d.y,29,{isStatic:!0,isSensor:!0}),f=new PIXI.Graphics;f.lineStyle(2,16706423,1);f.drawCircle(0,0,29);f.endFill();f.position.x=d.x;f.position.y=d.y;c.state.isDebug&&c.addChild(f);var g=new PIXI.Sprite(PIXI.Texture.from("ingame_star0000"));g.anchor.set(.5);g.x=d.x;g.y=d.y;a.addChild(g);c.stars.push({body:e,sprite:g,wireFrame:f})})};
Level.prototype.addlandZones=function(){var a=this;this.data.levels[this.state.game.currentLevel].landZones.forEach(function(b){var c=Matter.Bodies.rectangle(b.width/2+b.x,b.height/2+b.y,b.width,b.height,{isStatic:!0});if(a.state.isDebug){var d=new PIXI.Graphics;d.lineStyle(2,16706423,1);d.drawRect(b.x,b.y,b.width,b.height);d.endFill();a.addChild(d)}a.landZones.push(c)})};Level.prototype.getLandZones=function(){return this.landZones};
Level.prototype.getAllBodiesInThisLevel=function(){return[this.getLandZones(),this.getLander().body,this.terrain.body,this.stars.map(function(a){return a.body}),this.bonus.map(function(a){return a.body})].flat()};Level.prototype.removeKeyEvents=function(){this.keyUp.unsubscribe();this.keyRight.unsubscribe();this.keyLeft.unsubscribe()};
Level.prototype.addKeysEvents=function(){var a=this;this.state.log("adding key Events");this.keyUp=keyboard("ArrowUp");this.keyRight=keyboard("ArrowRight");this.keyLeft=keyboard("ArrowLeft");this.keySpace=keyboard(" ");this.state.keyUp=this.keyUp;this.state.keyRight=this.keyRight;this.state.keyLeft=this.keyLeft;this.state.keySpace=this.keySpace;var b=this;this.keySpace.press=function(){b.state.isPause?(b.state.log("EXIT PAUSE"),b.ui.updateTextField(b.ui.screenInfos,"",Tools.pixiColor("#ffc0c0"),!0),
b.state.isPause=!1):(b.state.log("ENTER PAUSE"),b.ui.updateTextField(b.ui.screenInfos,"Pause",Tools.pixiColor("#ffc0c0"),!0),setTimeout(function(){b.state.isPause=!0},20))};this.keyLeft.press=function(){b.state.log("keyLeft pressed");0!=a.state.game.fuel&&b.lander.sprite.showStabilizersLeft()};this.keyLeft.release=function(){b.state.log("keyLeft Released");0!=a.state.game.fuel&&b.lander.sprite.hideStabilizersLeft()};this.keyRight.press=function(){b.state.log("keyRight pressed");0!=a.state.game.fuel&&
b.lander.sprite.showStabilizersRight()};this.keyRight.release=function(){b.state.log("keyRight Released");0!=a.state.game.fuel&&b.lander.sprite.hideStabilizersRight()};this.keyUp.press=function(){b.state.log("Up pressed");0!=a.state.game.fuel&&b.lander.sprite.showReactor()};this.keyUp.release=function(){b.state.log("Up Released");0!=a.state.game.fuel&&b.lander.sprite.hideReactor()}};
function Flag(a){this.params=a;PIXI.extras.AnimatedSprite.call(this,this.getAnimationLoop(1,35),!0);this.anchor.set(0,1);this.ticker=PIXI.ticker.shared;this.ticker.speed=.25;this.gotoAndPlay(0)}Flag.prototype=Object.create(PIXI.extras.AnimatedSprite.prototype);Flag.prototype.getAnimationLoop=function(a,b){for(var c=[];a<=b;a++){var d=PIXI.Texture.from(""+this.params.sprite+String(a-1).padStart(4,"0"));c.push(d)}return c};
function Stabilizer(a){this.params=a;PIXI.extras.AnimatedSprite.call(this,this.getAnimationLoop(1,8));this.anchor.set(1,0);this.ticker=PIXI.ticker.shared;this.ticker.speed=.25;this.gotoAndPlay(0);this.visible=!1;console.log(this)}Stabilizer.prototype=Object.create(PIXI.extras.AnimatedSprite.prototype);Stabilizer.prototype.getAnimationLoop=function(a,b){for(var c=[];a<=b;a++){var d=PIXI.Texture.from(""+this.params.sprite+String(a-1).padStart(4,"0"));c.push(d)}return c};
function Reactor(a){this.params=a;PIXI.extras.AnimatedSprite.call(this,this.getAnimationLoop(1,14),!0);this.anchor.set(.5,0);this.gotoAndPlay(0);this.visible=!1}Reactor.prototype=Object.create(PIXI.extras.AnimatedSprite.prototype);Reactor.prototype.getAnimationLoop=function(a,b){for(var c=[];a<=b;a++){var d=PIXI.Texture.from(""+this.params.sprite+String(a-1).padStart(4,"0"));c.push(d)}return c};
function LanderBody(a){this.box=null;return this.box=a.vertices?Matter.Bodies.fromVertices(a.x,a.y,a.vertices,{rot:0,density:a.density,frictionAir:a.frictionAir,friction:a.friction,restitution:a.restitution,render:{fillStyle:"#f19648",strokeStyle:"#f19648",lineWidth:1}},!1):Matter.Bodies.rectangle(a.x,a.y,a.width,a.height,{rot:0,density:a.density,frictionAir:a.frictionAir,friction:a.friction,restitution:a.restitution})}
function BonusSprite(a,b){PIXI.Container.call(this);this.graphic=new PIXI.Sprite(PIXI.Texture.from("bonus_"+a+"0000"));this.graphic.anchor.set(.5);this.addChild(this.graphic);b+="";this.tfAmount=Tools.customText({font:"DeadFontWalking",fontSize:20,color:BonusSprite.colorFromType[a],text:b,x:Math.ceil(-(10*b.length)/2),y:-10});this.tfAmount.interactive=!0;this.tfAmount.buttonMode=!0;this.addChild(this.tfAmount);State.getInstance().log(this)}BonusSprite.prototype=Object.create(PIXI.Container.prototype);
BonusSprite.colorFromType={fuel:"#f7afaf"};function Lander(a,b){this.params=b;PIXI.extras.AnimatedSprite.call(this,[PIXI.Texture.EMPTY]);this.stabilizers=[];this.flag=this.shell=this.reactor=null;this.addStabilizers(this.params.stabilizers);this.addReactor(this.params.reactor);this.addShell(this.params.sprite);this.addFlag(this.params.flag);this.gotoAndPlay(0);a.addChild(this)}Lander.prototype=Object.create(PIXI.extras.AnimatedSprite.prototype);
Lander.prototype.addShell=function(a){a=new PIXI.Sprite(PIXI.Texture.from(a));this.addChild(a);a.anchor.set(.5);this.shell=a};Lander.prototype.addFlag=function(a){var b=new Flag(a);b.x=a.x;b.y=a.y;a.rotation&&(b.rotation=a.rotation);this.addChild(b);b.visible=!1;this.flag=b};Lander.prototype.addReactor=function(a){var b=new Reactor(a);b.x=a.x;b.y=a.y;this.addChild(b);this.reactor=b};
Lander.prototype.addStabilizers=function(a){var b=this;a.forEach(function(c){var d=new Stabilizer(c);d.x=c.x;d.y=c.y;c.rotation&&(d.rotation=c.rotation);b.addChild(d);b.stabilizers.push(d)})};Lander.prototype.update=function(){};Lander.prototype.hideFlag=function(){this.flag.visible=!1};Lander.prototype.showFlag=function(){this.flag.visible=!0};Lander.prototype.hideReactor=function(){this.reactor.visible=!1};Lander.prototype.showReactor=function(){this.reactor.visible=!0};
Lander.prototype.hideStabilizersRight=function(){for(var a=0;a<this.stabilizers.length/2;a++)this.stabilizers[a].visible=!1};Lander.prototype.showStabilizersRight=function(){for(var a=0;a<this.stabilizers.length/2;a++)this.stabilizers[a].visible=!0};Lander.prototype.hideStabilizersLeft=function(){for(var a=this.stabilizers.length/2;a<this.stabilizers.length;a++)this.stabilizers[a].visible=!1};
Lander.prototype.showStabilizersLeft=function(){for(var a=this.stabilizers.length/2;a<this.stabilizers.length;a++)this.stabilizers[a].visible=!0};var Landers=Landers||{};
Landers.create=function(a,b){function c(d){var e=new LanderBody(d);d=d.vertices?Tools.wireFrameFromVertex(d.x,d.y,d.vertices,!0,"#08fff2"):Tools.wireFrameFromVertex(d.x,d.y,[{x:d.x,y:d.y},{x:d.width,y:d.y},{x:d.width,y:d.height},{x:d.x,y:d.height},{x:d.x,y:d.y}],!0,"#08fff2");return{box:e,wireFrame:d}}return function(){var d=new c(a.physic);return{sprite:new Lander(b,a.sprite),body:d.box,wireFrame:d.wireFrame}}()};
Landers.explode=function(a,b,c){a=PIXI.Texture.from(a.sprite.params.sprite);var d=Tools.SpriteSheetAutoSlicer("lander",5,5,a),e=JSON.parse(d),f,g,l=[];(new PIXI.Spritesheet(a.baseTexture,e)).parse(function(n){var m=new PIXI.Container;Object.keys(e.frames).forEach(function(k,p){0==p&&(f=e.frames[k].sourceSize.w,g=e.frames[k].sourceSize.h);p=new PIXI.Sprite(n[k]);p.anchor.set(.5);p.position=e.frames[k].original;m.addChild(p);l.push(p)});var h=Matter.Composites.stack(b.lander.body.position.x-b.lander.sprite.width/
2,b.lander.body.position.y-b.lander.sprite.height/2,5,5,0,0,function(k,p){k=Matter.Bodies.rectangle(k,p,f,g,{restitution:Tools.randomBetween(.1,.5)});Matter.Body.setMass(k,Tools.randomBetween(2,5));Matter.Body.setAngularVelocity(k,2*Math.random()-1);console.log(k);return k});Matter.Composite.rotate(h,b.lander.body.angle,{x:b.lander.body.position.x,y:b.lander.body.position.y});Matter.World.add(b.engine.world,h.bodies);b.addChild(m);c({bodies:h.bodies,sprites:l})})};var Terrains=Terrains||{};
Terrains.load=function(a,b,c){if(void 0===Tools)throw Error("Must have Tools.js");Tools.ajaxGet(a.terrain,function(d){Terrains.create(d,a.centerOfMass,b,c)})};
Terrains.create=function(a,b,c,d){function e(f){f=(new window.DOMParser).parseFromString(f,"image/svg+xml");var g=Array.prototype.slice.call(f.querySelectorAll("path")).map(function(l){return Matter.Svg.pathToVertices(l,5)});console.log("vertexSets:",g);f=Matter.Bodies.fromVertices(b.x,b.y,g,{isStatic:!0,render:{fillStyle:"#060a19",strokeStyle:"#060a19",lineWidth:1}},!1);g=Tools.wireFrameFromVertex(360,1290,g);return{terrain:f,wireFrame:g}}a=function(f){f=new e(f);return{sprite:new PIXI.Sprite(PIXI.Texture.from("terrain"+
c)),body:f.terrain,wireFrame:f.wireFrame}}(a);d(a)};function ButtonSprite(a){PIXI.Sprite.call(this,PIXI.Texture.from("ui_button_nb0000"));this.state=State.getInstance();this.outed();a+="";this.text=Tools.customText({font:"DeadFontWalking",fontSize:30,color:"#fffafa",text:a,x:Math.ceil(-(15*a.length)/2),y:-15});this.addChild(this.text);this.buttonMode=this.interactive=!0}ButtonSprite.prototype=Object.create(PIXI.Sprite.prototype);ButtonSprite.prototype.overed=function(){this.tint=Tools.pixiColor(this.state.menuData.bg[Tools.getHash()].tintOver)};
ButtonSprite.prototype.outed=function(){this.tint=Tools.pixiColor(this.state.menuData.bg[Tools.getHash()].tint)};
function Button(a,b){PIXI.Container.call(this);this.index=a;this.pos=b;var c=this;this.hiddenPos={x:this.pos.x-800,y:this.pos.y};this.bt=new ButtonSprite(a+1);this.bt.on("click",this.emit.bind(this));this.bt.on("mouseover",function(){c.bt.overed()});this.bt.on("mouseout",function(){c.bt.outed()});this.bt.anchor.set(.5);this.addChild(this.bt);this.body=this.addPhysic(b);this.starsSprites=this.createStars(this.body);this.comeIn();this.emitter=new PIXI.utils.EventEmitter;this.emitterContext={id:this.index}}
Button.prototype=Object.create(PIXI.Container.prototype);Button.prototype.comeIn=function(){gsap.to(this.getBtPhysic().position,{x:this.pos.x,duration:2,delay:.15*(this.index+1),ease:"elastic.out(1, 0.5)"})};Button.prototype.emit=function(){this.emitter.emit("out",this.emitterContext)};Button.prototype.comeOut=function(){gsap.to(this.getBtPhysic().position,{x:this.pos.x+800,duration:1,ease:"elastic.in(1, 0.75)"})};
Button.prototype.addPhysic=function(){var a=Matter.Composite.create(),b=Matter.Bodies.circle(this.hiddenPos.x,this.pos.y,5,{isStatic:!0,label:"button",collisionFilter:{group:this.index}});Matter.Composite.add(a,[b]);var c=Matter.Bodies.polygon(this.hiddenPos.x-30,this.pos.y+40,5,20,{label:"star1",density:10,restitution:0,collisionFilter:{group:this.index}}),d=Matter.Bodies.polygon(this.hiddenPos.x,this.pos.y+50,5,20,{label:"star2",density:10,restitution:0,collisionFilter:{group:this.index}}),e=Matter.Bodies.polygon(this.hiddenPos.x+
30,this.pos.y+40,5,20,{label:"star3",density:10,restitution:0,collisionFilter:{group:this.index}}),f=this.createConstraint(b,c),g=this.createConstraint(b,d);b=this.createConstraint(b,e);Matter.Composite.add(a,[c,f]);Matter.Composite.add(a,[d,g]);Matter.Composite.add(a,[e,b]);return a};Button.prototype.createConstraint=function(a,b){return Matter.Constraint.create({bodyA:a,pointA:{x:0,y:0},bodyB:b,pointB:{x:0,y:-5},stiffness:.6})};
Button.prototype.createStars=function(a){var b=this,c=[],d=/star/;a.bodies.filter(function(e){return d.test(e.label)}).forEach(function(e){var f=new PIXI.Sprite(PIXI.Texture.from("ui_star0000"));c.push(f);f.anchor.set(.5);f.position=e.position;b.addChild(f)});return c};Button.prototype.update=function(){var a=this;this.getStarsPhysic().forEach(function(b,c){a.starsSprites[c].position=b.position;a.starsSprites[c].rotation=b.angle});a.bt.position=this.getBtPhysic().position;a.bt.rotation=this.getBtPhysic().angle};
Button.prototype.getBtPhysic=function(){var a=/button/;return this.body.bodies.filter(function(b){return a.test(b.label)})[0]};Button.prototype.getStarsPhysic=function(){var a=/star/;return this.body.bodies.filter(function(b){return a.test(b.label)})};function MenuBg(a){PIXI.Container.call(this);this.state=State.getInstance();this.sprites=[];this.displayElements(a)}MenuBg.prototype=Object.create(PIXI.Container.prototype);
MenuBg.prototype.displayElements=function(a){var b=this;this.state.menuData.bg[a].sprites.forEach(function(c){var d=new PIXI.Sprite(PIXI.Texture.from(c.name));d.anchor.set(.5);d.position=c.position;c.tint&&(d.tint=Tools.pixiColor(c.tint));c.scale&&(d.scale=c.scale);c.filter&&(c=new PIXI.filters.BlurFilter(c.filter.size,3,3),c.autoFit=!0,d.filters=[c]);b.sprites.push(d);b.addChild(d)})};
function Menu(a,b){PIXI.Container.call(this);this.state=State.getInstance();this.engine=b;this.emitter=new PIXI.utils.EventEmitter;this.bodies=[];this.sprites=[];this.bg=null;b=this.state.menuData.bg[Tools.getHash()].quote.replace(/@/g,'"');this.quote=Tools.customText({font:"DeadFontWalking",fontSize:30,color:"#fffafa",text:b,x:400,y:40},!0);b=this.state.menuData.bg[Tools.getHash()].title.replace(/@/g,'"');this.title=Tools.customText({font:"DeadFontWalking",fontSize:50,color:this.state.menuData.bg[Tools.getHash()].tint,
text:b,x:400,y:540},!0);this.showMenu(this.state.menuData.worlds.indexOf(Tools.getHash()));this.addChild(this.quote);this.addChild(this.title);a.addChild(this)}Menu.prototype=Object.create(PIXI.Container.prototype);
Menu.prototype.showMenu=function(a){this.bg=new MenuBg(this.state.menuData.worlds[void 0===a?0:a]);this.addChild(this.bg);for(a=0;10>a;a++){var b=this.getPosition(a);b=new Button(a,b);this.sprites.push(b);this.addChild(b);this.bodies.push(b.body);b.emitter.on("out",this.launchLevel.bind(this))}Matter.World.add(this.engine.world,this.bodies)};
Menu.prototype.launchLevel=function(a){console.log(a);this.sprites.forEach(function(b){b.comeOut()});gsap.to(this.bg.position,{x:this.bg.position.x+800,duration:1,delay:.5,ease:"power4.in",onComplete:this.quitToLevel.bind(this),onCompleteParams:[a]})};Menu.prototype.quitToLevel=function(a){console.log("quitToLevel",a);this.emitter.emit("start",a)};Menu.prototype.getPosition=function(a){return{x:115+a%5*140,y:500/3*(4<a?2:1)+25}};Menu.prototype.update=function(){this.sprites.forEach(function(a){a.update()})};
function Main(a){this.loaderDomElmt=document.getElementById("loader");this.view=document.getElementById("game-canvas");this.loader=PIXI.loader;this.data=a;this.state=State.getInstance();this.state.game.speedMax=this.data.lander.motor.speedMax;this.state.game.fuelMax=this.data.lander.motor.fuel;this.state.game.fuel=this.data.lander.motor.fuel;this.engine=Matter.Engine.create();this.bodies=[];this.stage=new PIXI.Container;this.renderer=PIXI.autoDetectRenderer(800,600,{backgroundColor:Tools.pixiColor("#00000c"),
antialias:!0,view:this.view});this.loopID=this.menu=this.level=null;this.loadSpriteSheet()}Main.prototype.showCanvas=function(){this.view.style="";this.loaderDomElmt.style="display: none;"};Main.prototype.showLoader=function(){this.view.style="display: none;";this.loaderDomElmt.style=""};
Main.prototype.loadSpriteSheet=function(){var a=this;this.state.log("LOAD");this.data.levels.forEach(function(b,c){a.loader.add("terrain"+c,b.sprite)});this.loader.add("landersSpriteSheet","./assets/landers.json");this.loader.add("uiSpriteSheet","./assets/ui.json");this.loader.add("deadFontWalking","./assets/DeadFontWalking.fnt");this.loader.once("complete",this.spriteSheetLoaded.bind(this));this.loader.load()};Main.prototype.spriteSheetLoaded=function(){this.state.log("LOADED");this.addMenu()};
Main.prototype.initLevel=function(a){this.showLoader();var b=this;this.removeMenu();this.ui=this.createUi();this.state.game.currentLevel=a.id;this.level=new Level(this,function(){b.level.getAllBodiesInThisLevel().forEach(function(c){b.bodies.push(c)});b.initAfterLoadingTerrain()});this.stage.addChild(this.ui)};
Main.prototype.addMenu=function(){this.menu=new Menu(this.stage,this.engine);this.menu.emitter.on("start",this.initLevel.bind(this));this.addMouseConstraint();console.log("BODIES",this.menu.bodies);this.showCanvas();this.loopID=requestAnimationFrame(this.updateMenu.bind(this))};Main.prototype.removeMenu=function(){cancelAnimationFrame(this.loopID);this.stage.removeChild(this.menu);this.menu=null;Matter.World.clear(this.engine.world)};
Main.prototype.initAfterLoadingTerrain=function(){var a=this;this.state.log("initAfterLoadingTerrain");this.engine.world.gravity.scale=this.data.environment.gravityScale;Matter.World.add(this.engine.world,this.bodies);this.showCanvas();this.addMouseConstraint();this.startSequency(function(){a.level.addKeysEvents();a.loopID=requestAnimationFrame(a.update.bind(a))});this.showCanvas()};
Main.prototype.startSequency=function(a){var b=this,c=0;[{text:"Get ready",time:3,color:"#c7ff8f"},{text:"3",time:1,color:"#ff8f8f"},{text:"2",time:1,color:"#ffd88f"},{text:"1",time:1,color:"#c7ff8f"},{text:"let's Go",time:1,color:"#ffffff"}].forEach(function(d){setTimeout(function(){b.ui.updateTextField(b.ui.screenInfos,d.text,Tools.pixiColor(d.color),!0);console.log(d.text);b.renderer.render(b.stage)},1E3*c);c+=d.time});setTimeout(function(){b.ui.updateTextField(b.ui.screenInfos,"",Tools.pixiColor("#7fff00"));
a()},1E3*(c+1))};Main.prototype.createUi=function(){return new Ui(this.data)};Main.prototype.addMouseConstraint=function(){var a=Matter.Mouse.create(this.renderer.view),b=Matter.MouseConstraint.create(this.engine,{mouse:a,constraint:{stiffness:.2,angularStiffness:0,render:{visible:!1}}});Matter.World.add(this.engine.world,b);this.renderer.mouse=a};Main.prototype.updateMenu=function(){this.menu.update();Matter.Engine.update(this.engine);this.renderer.render(this.stage);this.loopID=requestAnimationFrame(this.updateMenu.bind(this))};
Main.prototype.update=function(){this.state.isPause||(Matter.Engine.update(this.engine),this.level.update(),this.updateViewLevel(this.level),this.level.isGameOver||this.ui.update(),this.renderer.render(this.stage));this.loopID=requestAnimationFrame(this.update.bind(this))};Main.prototype.updateViewLevel=function(a){var b=300-a.getLander().body.position.y;a.y=Math.min(0,Math.max(b,-1400))};
Main.prototype.loadWorldData=function(a){var b=this;Tools.ajaxGet("./data/"+this.menuData.worlds[a]+".json",function(c){c=JSON.parse(c);b.data=c})};
